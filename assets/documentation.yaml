openapi: 3.1.0
info:
  title: MealPrep API
  version: 1.1.0
  description: MealPrep est un web service permettant la gestion de recettes, la composition de repas et la génération de menus hebdomadaires.
  contact:
    name: MealPrep Team

servers:
  - url: http://localhost:8090
    description: Development server

tags:
  - name: Menus
    description: Gestion des menus
  - name: Repas
    description: Gestion des repas
  - name: Recettes
    description: Gestion des recettes
  - name: Ingrédients
    description: Gestion des ingrédients
  - name: API Keys
    description: Gestion des clés API

paths:
  /v1/api-keys/register:
    post:
      tags:
        - API Keys
      summary: Générer une nouvelle clé API
      description: Endpoint public pour obtenir une clé API. Aucune authentification requise - c'est le point d'entrée pour les développeurs.
      operationId: registerApiKey
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                  description: Nom descriptif pour identifier cette clé (ex "Mon App Mobile")
                  example: "Mon App Mobile"
                email:
                  type: string
                  format: email
                  description: Email de contact (optionnel)
                  example: "dev@example.com"
      responses:
        "201":
          description: Clé API créée avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: number
                    example: 201
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                        description: Identifiant unique de la clé
                      key:
                        type: string
                        description: "La clé API (format: sk_test_xxx ou sk_live_xxx). IMPORTANT: Stockez-la en sécurité, elle ne sera plus visible après cette réponse."
                        example: "sk_test_8f7e6d5c4b3a2910a1b2c3d4e5f67890abcdef123456789012345678"
                      name:
                        type: string
                        example: "Mon App Mobile"
                      role:
                        type: string
                        example: "user"
                      isActive:
                        type: boolean
                        example: true
                      createdAt:
                        type: string
                        format: date-time
        "422":
          description: Validation échouée
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    const: error
                  message:
                    type: string
                    example: "Name is required"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/menus:
    get:
      tags:
        - Menus
      summary: Récupérer les menus
      operationId: listMenus
      security:
        - ApiKeyAuth: []
      parameters:
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        "200":
          description: Liste des menus
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MenuListResponse"
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  message: { type: string, example: "API key is required in 'x-api-key' header" }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  message: { type: string, example: "API key is inactive" }
        "422":
          description: Paramètres de requête invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  message: { type: string, example: "Invalid limit parameter" }
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      tags:
        - Menus
      summary: Sauvegarder/Créer un menu
      operationId: createMenu
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, mealIds]
              properties:
                name: { type: string, example: "Menu de la semaine" }
                description: { type: string, example: "Menu équilibré pour 7 jours" }
                duration: { type: integer, example: 7, description: "Durée du menu en jours" }
                mealIds:
                  type: array
                  description: Liste des IDs de repas à inclure dans le menu
                  items:
                    type: object
                    required: [mealId, dayNumber]
                    properties:
                      mealId: { type: string, format: uuid, description: "ID du repas existant" }
                      dayNumber: { type: integer, minimum: 1, maximum: 7, description: "Jour de la semaine (1-7)" }
      responses:
        "201":
          description: Menu créé avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleMenuResponse"
        "400":
          description: Données invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  message: { type: string, example: "The meal provided for this menu does not exist" }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  message: { type: string, example: "Invalid API key" }
        "404":
          description: Repas non trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  message: { type: string, example: "Meal not found" }
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/menus/generate:
    get:
      tags:
        - Menus
      summary: Générer un menu complet
      description: Génère un menu (plusieurs repas sur plusieurs jours) avec critères nutritionnels Min/Max
      operationId: generateMenu
      security:
        - ApiKeyAuth: []
      parameters:
        - name: duration
          description: Nombre de jours sur lesquels s'étale le menu
          in: query
          schema: { type: integer }
        - name: diet
          in: query
          schema:
            type: string
            enum: [vegetarian, vegan, keto, paleo, other]
        - name: caloriesMin
          in: query
          schema: { type: integer }
        - name: caloriesMax
          in: query
          schema: { type: integer }
        - name: proteinsMin
          in: query
          schema: { type: integer }
        - name: proteinsMax
          in: query
          schema: { type: integer }
        - name: fatsMin
          in: query
          schema: { type: integer }
        - name: fatsMax
          in: query
          schema: { type: integer }
        - name: carbsMin
          in: query
          schema: { type: integer }
        - name: carbsMax
          in: query
          schema: { type: integer }
        - name: sugarsMin
          in: query
          schema: { type: integer }
        - name: sugarsMax
          in: query
          schema: { type: integer }
        - name: fiberMin
          in: query
          schema: { type: integer }
        - name: fiberMax
          in: query
          schema: { type: integer }
        - name: saltMin
          in: query
          schema: { type: number }
        - name: saltMax
          in: query
          schema: { type: number }
      responses:
        "200":
          description: Menu généré avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MenuDetailResponse"
        "400":
          description: Paramètres invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Invalid duration parameter" } } }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Aucune recette trouvée avec les critères
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "No recipes found matching criteria" } } }
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/menus/{id}:
    get:
      tags:
        - Menus
      summary: Détails d'un menu
      operationId: getMenu
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Détails du menu récupérés avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MenuDetailResponse"
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Menu non trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Menu not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"
    put:
      tags:
        - Menus
      summary: Modifier un menu
      operationId: updateMenu
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                description: { type: string }
                meals:
                  type: array
                  items:
                    type: object
                    properties:
                      mealId: { type: string, format: uuid }
                      dayNumber: { type: integer }
      responses:
        "200":
          description: Menu mis à jour avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleMenuResponse"
        "400":
          description: Données invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "L'ID du repas doit être un UUID valide." } } }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Menu ou repas non trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Menu not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags:
        - Menus
      summary: Supprimer un menu
      operationId: deleteMenu
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Menu supprimé avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: success }
                  data:
                    type: object
                    properties:
                      message: { type: string, example: "Menu deleted successfully" }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Menu non trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Menu not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/recipes:
    get:
      tags:
        - Recettes
      summary: Lister les recettes
      description: Récupère la liste des recettes
      operationId: listRecipes
      parameters:
        - name: category
          in: query
          schema:
            type: string
            enum: [appetizer, side_dish, dessert, snack, beverage, other]
        - name: diet
          in: query
          schema:
            type: string
            enum:
              [
                vegetarian,
                vegan,
                gluten_free,
                dairy_free,
                keto,
                paleo,
                low_carb,
                other,
              ]
        - name: search
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: Liste récupérée avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecipeListResponse"
        "400":
          description: Paramètres de requête invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Invalid limit parameter" } } }
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      tags:
        - Recettes
      summary: Ajouter une recette
      description: Créer une nouvelle recette
      operationId: createRecipe
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecipeInput"
      responses:
        "201":
          description: Recette créée avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleRecipeResponse"
        "400":
          description: Données invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Title is required" } } }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/recipes/{id}:
    get:
      tags:
        - Recettes
      summary: Détails d'une recette
      description: Récupère une recette donnée via son identifiant
      operationId: getRecipe
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Détails de la recette récupérés avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleRecipeResponse"
        "404":
          description: Recette non trouvée
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Recipe not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"

    patch:
      tags:
        - Recettes
      summary: Modifier une recette
      description: Modifie une recette via son identifiant
      operationId: updateRecipe
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecipeInput"
      responses:
        "200":
          description: Recette modifiée avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleRecipeResponse"
        "400":
          description: Données invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Title is required" } } }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Recette non trouvée
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Recipe not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      tags:
        - Recettes
      summary: Supprimer une recette
      description: Supprimer une recette via son identifiant
      operationId: deleteRecipe
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Recette supprimée avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: success }
                  data:
                    type: object
                    properties:
                      message: { type: string, example: "Recipe deleted successfully" }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Recette non trouvée
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Recipe not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/meals:
    get:
      tags:
        - Repas
      summary: Lister les repas
      description: Récupère la liste des repas générés
      operationId: listMeals
      security:
        - ApiKeyAuth: []
      parameters:
        - name: mealType
          in: query
          schema:
            type: string
            enum: [breakfast, lunch, dinner, snack]
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        "200":
          description: Liste des repas récupérée avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MealListResponse"
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "422":
          description: Paramètres de requête invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Invalid limit parameter" } } }
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      tags:
        - Repas
      summary: Créer un repas
      description: Crée un nouveau repas composé de plusieurs recettes
      operationId: createMeal
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [mealType, recipeIds]
              properties:
                mealType:
                  type: string
                  enum: [breakfast, lunch, dinner, snack]
                recipeIds:
                  type: array
                  items:
                    type: string
                    format: uuid
      responses:
        "201":
          description: Repas créé avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleMealResponse"
        "400":
          description: Données invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "MealType is required" } } }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Recettes non trouvées
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "One or more recipes not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/meals/generate:
    get:
      tags:
        - Repas
      summary: Générer un repas spécifique
      description: Génère un repas composé selon des critères nutritionnels précis
      operationId: generateMeal
      security:
        - ApiKeyAuth: []
      parameters:
        - name: diet
          in: query
          schema:
            type: string
            enum:
              [
                vegetarian,
                vegan,
                gluten_free,
                dairy_free,
                keto,
                paleo,
                low_carb,
                other,
              ]
        - name: typeExclude
          in: query
          description: Type de recette à exclure
          schema:
            type: string
            example: "dessert"
        - name: caloriesMin
          in: query
          schema: { type: integer }
        - name: caloriesMax
          in: query
          schema: { type: integer }
        - name: proteinsMin
          in: query
          schema: { type: integer }
        - name: proteinsMax
          in: query
          schema: { type: integer }
        - name: fatsMin
          in: query
          schema: { type: integer }
        - name: fatsMax
          in: query
          schema: { type: integer }
        - name: carbsMin
          in: query
          schema: { type: integer }
        - name: carbsMax
          in: query
          schema: { type: integer }
        - name: sugarsMin
          in: query
          schema: { type: integer }
        - name: sugarsMax
          in: query
          schema: { type: integer }
        - name: fiberMin
          in: query
          schema: { type: integer }
        - name: fiberMax
          in: query
          schema: { type: integer }
        - name: saltMin
          in: query
          schema: { type: number }
        - name: saltMax
          in: query
          schema: { type: number }
      responses:
        "200":
          description: Repas généré avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MealListResponse"
        "400":
          description: Paramètres invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Invalid parameter value" } } }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Aucune recette trouvée
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "No recipes found matching criteria" } } }
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/meals/{id}:
    get:
      tags:
        - Repas
      summary: Détails d'un repas
      description: Récupère un repas donné via son identifiant
      operationId: getMeal
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Détails récupérés avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleMealResponse"
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Repas non trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Meal not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"
    put:
      tags:
        - Repas
      summary: Modifier un repas
      description: Modifie un repas via son identifiant
      operationId: updateMeal
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                mealType:
                  type: string
                  enum: [breakfast, lunch, dinner, snack]
                recipeIds:
                  type: array
                  items: { type: string, format: uuid }
      responses:
        "200":
          description: Repas modifié avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleMealResponse"
        "400":
          description: Données invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "MealType is required" } } }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Repas ou recettes non trouvé(e)s
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Meal not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags:
        - Repas
      summary: Supprimer un repas
      description: Supprimer un repas via son identifiant
      operationId: deleteMeal
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Repas supprimé avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: success }
                  data:
                    type: object
                    properties:
                      message: { type: string, example: "Meal deleted successfully" }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "404":
          description: Repas non trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Meal not found" } } }
        "500":
          $ref: "#/components/responses/InternalError"

  # ============= INGREDIENTS =============

  /v1/ingredients:
    get:
      tags:
        - Ingrédients
      summary: Récupérer tous les ingrédients
      description: Liste tous les ingrédients avec filtres optionnels
      operationId: listIngredients
      parameters:
        - name: category
          in: query
          description: Filtrer par catégorie
          required: false
          schema:
            type: string
            enum:
              - VEGETABLE
              - FRUIT
              - MEAT
              - FISH
              - DAIRY
              - GRAIN
              - LEGUME
              - NUT
              - SPICE
              - OIL
              - OTHER
        - name: search
          in: query
          description: Recherche par nom
          required: false
          schema:
            type: string
        - name: limit
          in: query
          description: Limiter le nombre de réponses retournées
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          description: Pagination
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        "200":
          description: Liste des ingrédients récupérée avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IngredientListResponse"
        "400":
          description: Paramètres de requête invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Invalid limit parameter" } } }
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      tags:
        - Ingrédients
      summary: Créer un nouvel ingrédient
      description: Ajoute un nouvel ingrédient à la base de données
      operationId: createIngredient
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  description: Nom de l'ingrédient
                category:
                  type: string
                  enum:
                    - VEGETABLE
                    - FRUIT
                    - MEAT
                    - FISH
                    - DAIRY
                    - GRAIN
                    - LEGUME
                    - NUT
                    - SPICE
                    - OIL
                    - OTHER
                proteins:
                  type: number
                  description: Protéines (g/100g)
                  default: 0
                fats:
                  type: number
                  description: Lipides (g/100g)
                  default: 0
                carbs:
                  type: number
                  description: Glucides (g/100g)
                  default: 0
                sugars:
                  type: number
                  description: Sucres (g/100g)
                  default: 0
                fiber:
                  type: number
                  description: Fibres (g/100g)
                  default: 0
                salt:
                  type: number
                  description: Sel (g/100g)
                  default: 0
                calories:
                  type: number
                  description: Calories (kcal/100g)
                  default: 0
                minerals:
                  type: array
                  description: Minéraux contenus
                  items:
                    type: object
                    properties:
                      mineralType:
                        type: string
                        enum:
                          - CALCIUM
                          - IRON
                          - MAGNESIUM
                          - POTASSIUM
                          - SODIUM
                          - ZINC
                          - PHOSPHORUS
                          - OTHER
                      value:
                        type: number
                vitamins:
                  type: array
                  description: Vitamines contenues
                  items:
                    type: object
                    properties:
                      vitaminType:
                        type: string
                        enum:
                          - VITAMIN_A
                          - VITAMIN_B1
                          - VITAMIN_B2
                          - VITAMIN_B3
                          - VITAMIN_B6
                          - VITAMIN_B12
                          - VITAMIN_C
                          - VITAMIN_D
                          - VITAMIN_E
                          - VITAMIN_K
                          - OTHER
                      value:
                        type: number
      responses:
        "201":
          description: Ingrédient créé avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleIngredientResponse"
        "400":
          description: Données invalides
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "Name is required" } } }
        "401":
          description: API key manquante ou invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is required in 'x-api-key' header" } } }
        "403":
          description: API key inactive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, const: error }
                  error: { type: object, properties: { message: { type: string, example: "API key is inactive" } } }
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/ingredients/{id}:
    get:
      tags:
        - Ingrédients
      summary: Récupérer un ingrédient
      description: Récupère les détails complets d'un ingrédient
      operationId: getIngredient
      parameters:
        - name: id
          in: path
          required: true
          description: ID de l'ingrédient
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Détails de l'ingrédient
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleIngredientResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    put:
      tags:
        - Ingrédients
      summary: Modifier un ingrédient
      description: Modifie un ingrédient existant
      operationId: updateIngredient
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID de l'ingrédient
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                category:
                  type: string
                proteins:
                  type: number
                fats:
                  type: number
                carbs:
                  type: number
                sugars:
                  type: number
                fiber:
                  type: number
                salt:
                  type: number
                calories:
                  type: number
                minerals:
                  type: array
                  items:
                    type: object
                    properties:
                      mineralType:
                        type: string
                      value:
                        type: number
                vitamins:
                  type: array
                  items:
                    type: object
                    properties:
                      vitaminType:
                        type: string
                      value:
                        type: number
      responses:
        "200":
          description: Ingrédient modifié avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleIngredientResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      tags:
        - Ingrédients
      summary: Supprimer un ingrédient
      description: Supprime un ingrédient existant
      operationId: deleteIngredient
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID de l'ingrédient
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Ingrédient supprimé avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    const: success
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: Ingredient deleted successfully
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

# ============= COMPONENTS =============
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key

  schemas:
    Recipe:
      type: object
      properties:
        id: { type: string, format: uuid }
        title: { type: string }
        description: { type: string, nullable: true }
        instructions: { type: string }
        imageUrl: { type: string, nullable: true }
        prepTimeMin: { type: integer }
        cookTimeMin: { type: integer }
        servings: { type: integer }
        category: { type: string }
        diet: { type: string }
        isPublic: { type: boolean }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    RecipeInput:
      type: object
      required: [title, category]
      properties:
        title: { type: string }
        description: { type: string }
        instructions: { type: string }
        imageUrl: { type: string }
        prepTimeMin: { type: integer }
        cookTimeMin: { type: integer }
        servings: { type: integer }
        category: { type: string }
        diet: { type: string }
        isPublic: { type: boolean }
        ingredients:
          type: array
          items:
            type: object
            properties:
              id: { type: string, format: uuid }
              quantity: { type: number }
              unit: { type: string }

    RecipeDetail:
      allOf:
        - $ref: "#/components/schemas/Recipe"
        - type: object
          properties:
            ingredients:
              type: array
              items:
                type: object
                properties:
                  ingredient: { $ref: "#/components/schemas/Ingredient" }
                  quantity: { type: number }
                  unit: { type: string }

    RecipeResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data: { $ref: "#/components/schemas/Recipe" }

    RecipeDetailResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data: { $ref: "#/components/schemas/RecipeDetail" }

    Meal:
      type: object
      description: Entité représentant un repas composé
      properties:
        id: { type: string, format: uuid }
        mealType:
          type: string
          enum: [breakfast, lunch, dinner, snack]
          default: lunch
          description: Le type de repas (issu de la DB Meal.mealType)
        recipes:
          type: array
          description: Les recettes qui composent ce repas (via DB RecipeMeal)
          items:
            type: object
            properties:
              type:
                type: string
                enum: ["starter", "main_course", "dessert"]
                description: Type de la recette (entrée, plat ou dessert)
              recipe:
                $ref: "#/components/schemas/Recipe"

    MealResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data: { $ref: "#/components/schemas/Meal" }

    MealSummary:
      type: object
      properties:
        id: { type: string, format: uuid }
        mealType: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        recipeMeals:
          type: array
          items:
            type: object
            properties:
              recipeId: { type: string, format: uuid }
              type: { type: integer }

    MealListResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data:
          type: object
          properties:
            meals:
              type: array
              items:
                $ref: "#/components/schemas/MealSummary"
            meta:
              type: object
              properties:
                total: { type: integer }
                offset: { type: integer }
                limit: { type: integer }

    SingleMealResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data:
          type: object
          properties:
            menus:
              type: array
              items:
                $ref: "#/components/schemas/MealSummary"
            meta:
              type: object
              properties:
                total: { type: integer, const: 1 }
                offset: { type: integer, const: 0 }
                limit: { type: integer, const: 1 }

    RecipeSummary:
      type: object
      properties:
        id: { type: string, format: uuid }
        title: { type: string }
        description: { type: string, nullable: true }
        instructions: { type: string }
        imageUrl: { type: string, nullable: true }
        prepTimeMin: { type: integer }
        cookTimeMin: { type: integer }
        servings: { type: integer }
        category: { type: string }
        diet: { type: string }
        isPublic: { type: boolean }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        recipeIngredient:
          type: array
          items:
            type: object
            properties:
              ingredientId: { type: string, format: uuid }
              quantity: { type: number }
              unit: { type: string }
              notes: { type: string, nullable: true }

    RecipeListResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data:
          type: object
          properties:
            recipes:
              type: array
              items:
                $ref: "#/components/schemas/RecipeSummary"
            meta:
              type: object
              properties:
                total: { type: integer }
                offset: { type: integer }
                limit: { type: integer }

    SingleRecipeResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data:
          type: object
          properties:
            recipes:
              type: array
              items:
                $ref: "#/components/schemas/RecipeSummary"
            meta:
              type: object
              properties:
                total: { type: integer, const: 1 }
                offset: { type: integer, const: 0 }
                limit: { type: integer, const: 1 }

    Menu:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        description: { type: string, nullable: true }
        duration: { type: integer, nullable: true }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        menuMeals:
          type: array
          description: Liste simplifiée des repas dans ce menu
          items:
            type: object
            properties:
              mealId: { type: string, format: uuid }
              dayNumber: { type: integer }

    MenuDetail:
      allOf:
        - $ref: "#/components/schemas/Menu"
        - type: object
          properties:
            meals:
              type: array
              description: Liste des repas assignés à ce menu avec leur jour (via DB MenuMeal)
              items:
                type: object
                properties:
                  dayNumber:
                    type: integer
                    description: Jour de la semaine (1-7)
                  meal:
                    $ref: "#/components/schemas/Meal"

    MenuDetailResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data: { $ref: "#/components/schemas/MenuDetail" }

    MenuListResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data:
          type: object
          properties:
            menus:
              type: array
              items:
                $ref: "#/components/schemas/Menu"
            meta:
              type: object
              properties:
                total: { type: integer }
                offset: { type: integer }
                limit: { type: integer }

    SingleMenuResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data:
          type: object
          properties:
            menus:
              type: array
              items:
                $ref: "#/components/schemas/Menu"
            meta:
              type: object
              properties:
                total: { type: integer, const: 1 }
                offset: { type: integer, const: 0 }
                limit: { type: integer, const: 1 }

    IngredientListResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data:
          type: object
          properties:
            ingredients:
              type: array
              items:
                $ref: "#/components/schemas/Ingredient"
            meta:
              type: object
              properties:
                total: { type: integer }
                offset: { type: integer }
                limit: { type: integer }

    SingleIngredientResponse:
      type: object
      properties:
        status: { type: string, const: success }
        data:
          type: object
          properties:
            ingredients:
              type: array
              items:
                $ref: "#/components/schemas/Ingredient"
            meta:
              type: object
              properties:
                total: { type: integer, const: 1 }
                offset: { type: integer, const: 0 }
                limit: { type: integer, const: 1 }

    Ingredient:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        category:
          type: string
          enum:
            - VEGETABLE
            - FRUIT
            - MEAT
            - FISH
            - DAIRY
            - GRAIN
            - LEGUME
            - NUT
            - SPICE
            - OIL
            - OTHER
          nullable: true
        proteins:
          type: number
          description: Protéines en grammes pour 100g
        fats:
          type: number
          description: Lipides en grammes pour 100g
        carbs:
          type: number
          description: Glucides en grammes pour 100g
        sugars:
          type: number
          description: Sucres en grammes pour 100g
        fiber:
          type: number
          description: Fibres en grammes pour 100g
        salt:
          type: number
          description: Sel en grammes pour 100g
        calories:
          type: number
          description: Calories en kcal pour 100g
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    IngredientDetail:
      allOf:
        - $ref: "#/components/schemas/Ingredient"
        - type: object
          properties:
            minerals:
              type: array
              items:
                type: object
                properties:
                  mineralType:
                    type: string
                    enum:
                      - CALCIUM
                      - IRON
                      - MAGNESIUM
                      - POTASSIUM
                      - SODIUM
                      - ZINC
                      - PHOSPHORUS
                      - OTHER
                  value:
                    type: number
            vitamins:
              type: array
              items:
                type: object
                properties:
                  vitaminType:
                    type: string
                    enum:
                      - VITAMIN_A
                      - VITAMIN_B1
                      - VITAMIN_B2
                      - VITAMIN_B3
                      - VITAMIN_B6
                      - VITAMIN_B12
                      - VITAMIN_C
                      - VITAMIN_D
                      - VITAMIN_E
                      - VITAMIN_K
                      - OTHER
                  value:
                    type: number

    NutritionInfo:
      type: object
      properties:
        proteins:
          type: number
          description: Protéines totales (g)
        fats:
          type: number
          description: Lipides totaux (g)
        carbs:
          type: number
          description: Glucides totaux (g)
        sugars:
          type: number
          description: Sucres totaux (g)
        fiber:
          type: number
          description: Fibres totales (g)
        salt:
          type: number
          description: Sel total (g)
        calories:
          type: number
          description: Calories totales (kcal)
        minerals:
          type: array
          items:
            type: object
            properties:
              mineralType:
                type: string
              value:
                type: number
        vitamins:
          type: array
          items:
            type: object
            properties:
              vitaminType:
                type: string
              value:
                type: number

  responses:
    BadRequest:
      description: Requête invalide
      content:
        application/json:
          schema:
            type: object
            properties:
              status: { type: string, const: error }
              message: { type: string }
    NotFound:
      description: Ressource non trouvée
    InternalError:
      description: Erreur serveur
